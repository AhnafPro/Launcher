<style>
    div {
        position: absolute;
        left: 0;
        top: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        width: 100vw;
        height: 100vh;
    }
</style>
<div>
    <h1>Proton Worker</h1>
    <p>This is a background process</p>
    <button onclick="complete()">Force Complete</button>
</div>
<script type="text/javascript">
    const ipc = require('electron').ipcRenderer;
    let id;

    complete = () => ipc.send('worker:finish', id);

    ipc.once('worker:start', async (event, data) => {
        id = data.id;
        let props = data.props;
        props.updateTask = (task, progress) => ipc.send('worker:task', { id: data.task, task, progress });
        props.complete = complete;
        props.isParallel = ipc.sendSync('config:get', 'app/parallelDownloads');
        props.error = er => ipc.send('reporter:submit', er);
        let func = new Function(`return ${data.work}`)();
        try {
            await func(props);
        } catch (e) {
            // Catch any unhandled exceptions todo this does not seem to work very well
            ipc.send('reporter:submit', e);
        }
    });
</script>
